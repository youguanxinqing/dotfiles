# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'

# ---------- basic config
set -s set-clipboard on
set -g window-style 'fg=colour247,bg=colour236'
set -g window-active-style 'fg=default,bg=black'
set -g mouse on
set -s set-clipboard on
set -g focus-events on
set -g default-terminal "tmux-256color"
# set -as terminal-overrides ",xterm-256color:RGB"
set -s escape-time 0
set -g update-environment "DISPLAY SSH_ASKPASS SSH_AUTH_SOCK SSH_AGENT_PID SSH_CONNECTION WINDOWID XAUTHORITY"

set -ga terminal-overrides ',tmux-256color:RGB'
set -ga terminal-overrides ',wezterm:RGB'
set -sa terminal-features ',wezterm:RGB'
set -g history-limit 50000

# Other examples:
# set -g @plugin 'github_username/plugin_name'
# set -g @plugin 'github_username/plugin_name#branch'
# set -g @plugin 'git@github.com:user/plugin'
# set -g @plugin 'git@bitbucket.com:user/plugin'

set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'fabioluciano/tmux-powerkit'

set -g @resurrect-processes 'ssh mysql redis-server npm'
set -g @resurrect-capture-pane-contents 'on'


# ---------- advanced config

# PowerKit 
set -g status on
set -g @powerkit_plugins "cpu,memory,git"
set -g @powerkit_theme "catppuccin"
set -g @powerkit_theme_variant "mocha"
set -g @powerkit_separator_style "flame"  # or normal, flame, pixel, honeycomb
set -g @powerkit_transparent "true"
set -g @powerkit_bar_layout "single"
set -g @powerkit_elements_spacing "both"

# Session Management
set -g @continuum-restore 'on'  # 自动恢复会话
set -g @continuum-save-interval '15'  # min
set -g @resurrect-strategy-nvim 'session'
set -g @resurrect-strategy-vim 'session'
set -g @resurrect-capture-pane-contents 'on'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'

# ---------- 鼠标配置（必须放在插件加载之后，避免被插件覆盖）

# 核心配置：鼠标拖拽选中后松开，不退出 copy-mode（不跳底部）
unbind -T copy-mode-vi MouseDragEnd1Pane
unbind -T copy-mode MouseDragEnd1Pane

# 鼠标拖拽进入 copy-mode（从正常模式）
bind -n MouseDrag1Pane if -Ft= '#{mouse_any_flag}' 'if -Ft= \"#{pane_in_mode}\" \"copy-mode -M\" \"send-keys -M\"' 'copy-mode -M'

# y 和 Enter 都可以复制并退出
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel
bind -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel

# 滚轮滚动时不退出 copy-mode
bind -T copy-mode-vi WheelUpPane select-pane \; send-keys -X -N 5 scroll-up
bind -T copy-mode-vi WheelDownPane select-pane \; send-keys -X -N 5 scroll-down

# 双击选中单词，三击选中整行（不自动复制，按 y 复制）
bind -T copy-mode-vi DoubleClick1Pane select-pane \; send-keys -X select-word
bind -T copy-mode-vi TripleClick1Pane select-pane \; send-keys -X select-line
bind -T root DoubleClick1Pane select-pane \; copy-mode -M \; send-keys -X select-word
bind -T root TripleClick1Pane select-pane \; copy-mode -M \; send-keys -X select-line
